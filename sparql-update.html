<!--
	@license
	Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
	This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
	The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
	The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
	Code distributed by Google as part of the polymer project is also
	subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-ajax/iron-ajax.html">

<!--
	An element providing a solution to update sparql endpoint like Fuseki.
	(https://github.com/scenaristeur/sparql-update)
	
	Example:
	
    <sparql-update></sparql-update>
	
	Example:
	
    <sparql-update>
	<h2>Hello sparql-update</h2>
    </sparql-update>
	
	@demo demo/index.html
	@hero hero.svg
-->

<dom-module id="sparql-update">
	<template>
		<style>
			:host {
			display: block;
			box-sizing: border-box;
			}
		</style>
		
		<iron-ajax
		id="ajax-update"
		url="http://rdf-smag0.rhcloud.com/ds/update"
		body="{{options}}"
		method="POST"
		handle-as="document"
		content-type="application/x-www-form-urlencoded"
		on-response="handleResponse"></iron-ajax>
		<paper-button 
		raised
		on-tap="sendUpdate">
			<iron-icon icon="check"></iron-icon>Envoyer
		</paper-button>
		<template is="dom-bind" result="{{result}}">
			
			Result : {{result}}
		</template>
		<!--handle-as="json"
		last-response="{{response}}"-->
	</template>
	
	<script>
		var update  =  "PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#> "; 
		update +=  "PREFIX rdfs:   <http://www.w3.org/2000/01/rdf-schema#>"; 
		update += "PREFIX smag:   <http://smag0.blogspot.fr/NS#>"; 
		update += "PREFIX zoo:   <http://example.org/zoo#>";
		update += "PREFIX owl: <http://www.w3.org/2002/07/owl#>";
		update += "PREFIX ex: <http://example.org#>";
		update+= "INSERT DATA {";
		update += "GRAPH <http://smag0.blogspot.fr/SparqlUpdate>{";
		//update += "smag:RobokIze    rdf:type         smag:Site ."; 
		//update +="smag:RobokIze   smag:objectif         'un site de vente revente piece detachees , pour robots, et objets connectes' ." ; 
		//     update += "ex:cat     rdfs:subClassOf  ex:animal .";
		//     update += "zoo:host   rdfs:range       ex:animal ."; 
		//     update += "ex:zoo1    zoo:host         ex:cat2 ."; 
		//     update += "ex:cat3    owl:sameAs       ex:cat2 .";
		//    update += "ex:cat3    owl:sameAs       ex:cat2 .";
		
		/*var sujet=document.getElementById("sujet").value;
			var propriete=document.getElementById("propriete").value;
			var objet=document.getElementById("objet").value;
		*/
		var sujet1="Sparql-statements";
		var propriete1="type";
		var objet1="Interface";
		update += "smag:"+sujet1+"    smag:"+propriete1+"         smag:"+objet1+" ."; 
		
		// fin requete avec graphe 
		var finRequete = "} }";
		//var finRequete = "}"; // fin requete sans graphe
		
		update+=finRequete;
		console.log(update);
		Polymer({
			is: 'sparql-update',
			
			properties: {
				/*sujet: {
					type: String,
					value: 'David',
					notify: true
					},
				*/
				/*		ds : {
					value: 'ds',
					notify: true
				},*/
				/*sujet : {
					value: 'json',
					notify: true
					},
					propriete: {
					
					value: 'type',
					notify: true					
					},
					objet:{
					value: 'Personne',
					notify: true					
				},*/
				sujet : {
					value: 'David',
					notify: true
				},
				propriete : {
					value: 'type',
					notify: true
				},
				objet : {
					value: 'Personne',
					notify: true
				},
				options: {
					
					//OKvalue: {update: update},
					//	notify : true
					////OKvalue:{update: "INSERT"}
					
					
					computed: 'computeUpdate(sujet)'
				},
				result: {
					notify: true
				}
				
			},
			computeUpdate: function(sujet){
				var up=JSON.stringify({update: update});
				return {update: update};
			},
			sendUpdate: function (e){
				console.log(this.sujet);
				console.log(this.propriete);
				
				console.log(this.objet);
				
				
				
			},
			handleResponse: function(data){
				
				
				var html=data.detail.response.getElementsByTagName("html")[0];
				console.log(html);
				var body=html.getElementsByTagName("body")[0];
				console.log(body);
				var resultat=body.getElementsByTagName("h1")[0];
				console.log(resultat);
				this.result=resultat;
				console.log(this.result);
				/*	for (i = 0; i < this.result.length; i++) {
					// txt += x[i].childNodes[0].nodeValue + "<br>";
					console.log(this.result[i].childNodes[0].nodeValue);
				}*/
			}
			/*computedUpdate: function(){
				var update  =  "PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#> "; 
				update +=  "PREFIX rdfs:   <http://www.w3.org/2000/01/rdf-schema#>"; 
				update += "PREFIX smag:   <http://smag0.blogspot.fr/NS#>"; 
				update += "PREFIX zoo:   <http://example.org/zoo#>";
				update += "PREFIX owl: <http://www.w3.org/2002/07/owl#>";
				update += "PREFIX ex: <http://example.org#>";
				update+= "INSERT DATA {";
				//update += "GRAPH <http://smag0.blogspot.fr/GraphTest>{";
				//update += "smag:RobokIze    rdf:type         smag:Site ."; 
				//update +="smag:RobokIze   smag:objectif         'un site de vente revente piece detachees , pour robots, et objets connectes' ." ; 
				//     update += "ex:cat     rdfs:subClassOf  ex:animal .";
				//     update += "zoo:host   rdfs:range       ex:animal ."; 
				//     update += "ex:zoo1    zoo:host         ex:cat2 ."; 
				//     update += "ex:cat3    owl:sameAs       ex:cat2 .";
				//    update += "ex:cat3    owl:sameAs       ex:cat2 .";
				
				var sujet=document.getElementById("sujet").value;
				var propriete=document.getElementById("propriete").value;
				var objet=document.getElementById("objet").value;
				update += "smag:"+sujet+"    smag:"+propriete+"         smag:"+objet+" ."; 
				
				// fin requete avec graphe var finRequete = "} }";
				var finRequete = "}"; // fin requete sans graphe
				
				update+=finRequete;
				console.log(update);
				
				
				
				
				return {update: "INSERT"};
				
				
				
				
				
			}*/
		});
	</script>
</dom-module>
